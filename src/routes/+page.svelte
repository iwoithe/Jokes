<script lang="ts">
  import type { PageData } from './$types'
  export let data: PageData;

  import { invalidate, invalidateAll } from '$app/navigation';
  import { invoke } from '@tauri-apps/api/tauri';

  import Favourite from "$lib/Favourite.svelte";
  
  function nextJoke() {
    invoke("next_joke");
    invalidateAll();
  }

  function previousJoke() {
    invoke("previous_joke");
    invalidateAll();
  }
</script>

<div class="wrapper">

  <h1 class="text-title text-align-center">Jokes</h1>

  <div class="content-wrapper">
    <div class="index-buttons-container">
      <a class="btn bg-blue text-body text-black text-dec-none" href="/browse">
        <svg fill="none" width="24" style="-webkit-print-color-adjust:exact" viewBox="557 436 24 24" height="24">
          <g id="shape-d636375e-351a-80df-8002-00547b6a128d" style="fill:#000000" width="16" height="16" class="bi bi-binoculars" rx="0" ry="0">
            <g id="shape-d636375e-351a-80df-8002-00547b6a128f">
              <g class="fills" id="fills-d636375e-351a-80df-8002-00547b6a128f">
                <path rx="0" ry="0" style="fill:#000000" d="M561.500,439.750C561.500,438.507,562.507,437.500,563.750,437.500L565.250,437.500C566.493,437.500,567.500,438.507,567.500,439.750L567.500,443.500L570.500,443.500L570.500,439.750C570.500,438.507,571.507,437.500,572.750,437.500L574.250,437.500C575.493,437.500,576.500,438.507,576.500,439.750L576.500,443.323C576.500,443.607,576.660,443.866,576.914,443.994L578.256,444.664C579.019,445.045,579.500,445.825,579.500,446.677L579.500,457.750C579.500,458.993,578.493,460.000,577.250,460.000L572.750,460.000C571.507,460.000,570.500,458.993,570.500,457.750L570.500,453.250C570.500,453.051,570.578,452.860,570.719,452.719L572.000,451.439L572.000,450.250C572.000,449.836,571.664,449.500,571.250,449.500L566.750,449.500C566.336,449.500,566.000,449.836,566.000,450.250L566.000,451.439L567.281,452.719C567.422,452.860,567.500,453.051,567.500,453.250L567.500,457.750C567.500,458.993,566.493,460.000,565.250,460.000L560.750,460.000C559.507,460.000,558.500,458.993,558.500,457.750L558.500,446.677C558.500,445.824,558.982,445.045,559.745,444.664L561.086,443.993C561.340,443.866,561.500,443.607,561.500,443.323L561.500,439.750ZZM563.750,439.000C563.336,439.000,563.000,439.336,563.000,439.750L563.000,440.500L566.000,440.500L566.000,439.750C566.000,439.336,565.664,439.000,565.250,439.000L563.750,439.000ZZM566.000,442.000L563.000,442.000L563.000,443.323C563.000,444.176,562.518,444.955,561.755,445.336L560.414,446.006C560.160,446.134,560.000,446.393,560.000,446.677L560.000,455.500L566.000,455.500L566.000,453.560L564.719,452.281C564.578,452.140,564.500,451.949,564.500,451.750L564.500,450.250C564.500,449.007,565.507,448.000,566.750,448.000L571.250,448.000C572.493,448.000,573.500,449.007,573.500,450.250L573.500,451.750C573.500,451.949,573.422,452.140,573.281,452.281L572.000,453.560L572.000,455.500L578.000,455.500L578.000,446.677C578.000,446.393,577.840,446.134,577.586,446.006L576.243,445.336C575.481,444.955,575.000,444.175,575.000,443.323L575.000,442.000L572.000,442.000L572.000,444.250C572.000,444.664,571.664,445.000,571.250,445.000L566.750,445.000C566.336,445.000,566.000,444.664,566.000,444.250L566.000,442.000ZZM572.000,440.500L575.000,440.500L575.000,439.750C575.000,439.336,574.664,439.000,574.250,439.000L572.750,439.000C572.336,439.000,572.000,439.336,572.000,439.750L572.000,440.500ZZM578.000,457.000L572.000,457.000L572.000,457.750C572.000,458.164,572.336,458.500,572.750,458.500L577.250,458.500C577.664,458.500,578.000,458.164,578.000,457.750L578.000,457.000ZZM566.000,457.000L560.000,457.000L560.000,457.750C560.000,458.164,560.336,458.500,560.750,458.500L565.250,458.500C565.664,458.500,566.000,458.164,566.000,457.750L566.000,457.000ZZ">
                </path>
              </g>
            </g>
          </g>
        </svg>
        Browse
      </a>
      <button class="btn bg-pink text-body">
        Favourites
      </button>
    </div>

    <div class="index-container">
      <!-- TODO: Alignment is wrong (look at design) -->
      <!-- Left arrow -->
      <button class="btn-arrow" on:click={previousJoke}>
        <svg class="icon-lg" viewBox="0 0 16 16">
          <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"/>
        </svg>
      </button>
      <!-- Content -->
      <div class="index-joke-container bg-white">
        <Favourite jokeId={ data.current_joke.id }></Favourite>
        <p id="joke-title-text" class="text-body-bold">{ @html data.current_joke.title }</p>
        {#if data.current_joke.body !== ""}
          <p id="joke-body-text" class="text-body">{ @html data.current_joke.body }</p>
        {/if}
      </div>
      <!-- Right arrow -->
      <button class="btn-arrow" on:click={nextJoke}>
        <svg class="icon-lg" viewBox="0 0 16 16">
          <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
        </svg>
      </button>
    </div>
  </div>
</div>
